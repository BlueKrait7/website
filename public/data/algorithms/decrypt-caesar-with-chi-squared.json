{
  "slug": "decrypt-caesar-with-chi-squared",
  "name": "Decrypt Caesar with Chi Squared",
  "categories": [
    "ciphers"
  ],
  "body": {},
  "implementations": {
    "python": {
      "dir": "ciphers\\decrypt_caesar_with_chi_squared.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/ciphers\\decrypt_caesar_with_chi_squared.py",
      "code": "<span class=\"hljs-comment\">#!/usr/bin/env python3</span>\r\n<span class=\"hljs-keyword\">from</span> __future__ <span class=\"hljs-keyword\">import</span> annotations\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">decrypt_caesar_with_chi_squared</span>(<span class=\"hljs-params\">\r\n    ciphertext: <span class=\"hljs-built_in\">str</span>,\r\n    cipher_alphabet: <span class=\"hljs-built_in\">list</span>[<span class=\"hljs-built_in\">str</span>] | <span class=\"hljs-literal\">None</span> = <span class=\"hljs-literal\">None</span>,\r\n    frequencies_dict: <span class=\"hljs-built_in\">dict</span>[<span class=\"hljs-built_in\">str</span>, <span class=\"hljs-built_in\">float</span>] | <span class=\"hljs-literal\">None</span> = <span class=\"hljs-literal\">None</span>,\r\n    case_sensitive: <span class=\"hljs-built_in\">bool</span> = <span class=\"hljs-literal\">False</span>,\r\n</span>) -&gt; <span class=\"hljs-built_in\">tuple</span>[<span class=\"hljs-built_in\">int</span>, <span class=\"hljs-built_in\">float</span>, <span class=\"hljs-built_in\">str</span>]:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Basic Usage\r\n    ===========\r\n    Arguments:\r\n    * ciphertext (str): the text to decode (encoded with the caesar cipher)\r\n\r\n    Optional Arguments:\r\n    * cipher_alphabet (list): the alphabet used for the cipher (each letter is\r\n      a string separated by commas)\r\n    * frequencies_dict (dict): a dictionary of word frequencies where keys are\r\n      the letters and values are a percentage representation of the frequency as\r\n      a decimal/float\r\n    * case_sensitive (bool): a boolean value: True if the case matters during\r\n      decryption, False if it doesn&#x27;t\r\n\r\n    Returns:\r\n    * A tuple in the form of:\r\n      (\r\n        most_likely_cipher,\r\n        most_likely_cipher_chi_squared_value,\r\n        decoded_most_likely_cipher\r\n      )\r\n\r\n      where...\r\n      - most_likely_cipher is an integer representing the shift of the smallest\r\n        chi-squared statistic (most likely key)\r\n      - most_likely_cipher_chi_squared_value is a float representing the\r\n        chi-squared statistic of the most likely shift\r\n      - decoded_most_likely_cipher is a string with the decoded cipher\r\n        (decoded by the most_likely_cipher key)\r\n\r\n\r\n    The Chi-squared test\r\n    ====================\r\n\r\n    The caesar cipher\r\n    -----------------\r\n    The caesar cipher is a very insecure encryption algorithm, however it has\r\n    been used since Julius Caesar. The cipher is a simple substitution cipher\r\n    where each character in the plain text is replaced by a character in the\r\n    alphabet a certain number of characters after the original character. The\r\n    number of characters away is called the shift or key. For example:\r\n\r\n    Plain text: hello\r\n    Key: 1\r\n    Cipher text: ifmmp\r\n    (each letter in hello has been shifted one to the right in the eng. alphabet)\r\n\r\n    As you can imagine, this doesn&#x27;t provide lots of security. In fact\r\n    decrypting ciphertext by brute-force is extremely easy even by hand. However\r\n     one way to do that is the chi-squared test.\r\n\r\n    The chi-squared test\r\n    -------------------\r\n    Each letter in the english alphabet has a frequency, or the amount of times\r\n    it shows up compared to other letters (usually expressed as a decimal\r\n    representing the percentage likelihood). The most common letter in the\r\n    english language is &quot;e&quot; with a frequency of 0.11162 or 11.162%. The test is\r\n    completed in the following fashion.\r\n\r\n    1. The ciphertext is decoded in a brute force way (every combination of the\r\n       26 possible combinations)\r\n    2. For every combination, for each letter in the combination, the average\r\n       amount of times the letter should appear the message is calculated by\r\n       multiplying the total number of characters by the frequency of the letter\r\n\r\n       For example:\r\n       In a message of 100 characters, e should appear around 11.162 times.\r\n\r\n     3. Then, to calculate the margin of error (the amount of times the letter\r\n        SHOULD appear with the amount of times the letter DOES appear), we use\r\n        the chi-squared test. The following formula is used:\r\n\r\n        Let:\r\n        - n be the number of times the letter actually appears\r\n        - p be the predicted value of the number of times the letter should\r\n          appear (see #2)\r\n        - let v be the chi-squared test result (referred to here as chi-squared\r\n          value/statistic)\r\n\r\n        (n - p)^2\r\n        --------- = v\r\n           p\r\n\r\n    4. Each chi squared value for each letter is then added up to the total.\r\n       The total is the chi-squared statistic for that encryption key.\r\n    5. The encryption key with the lowest chi-squared value is the most likely\r\n       to be the decoded answer.\r\n\r\n    Further Reading\r\n    ================\r\n\r\n    * http://practicalcryptography.com/cryptanalysis/text-characterisation/chi-squared-\r\n        statistic/\r\n    * https://en.wikipedia.org/wiki/Letter_frequency\r\n    * https://en.wikipedia.org/wiki/Chi-squared_test\r\n    * https://en.m.wikipedia.org/wiki/Caesar_cipher\r\n\r\n    Doctests\r\n    ========\r\n    &gt;&gt;&gt; decrypt_caesar_with_chi_squared(\r\n    ...    &#x27;dof pz aol jhlzhy jpwoly zv wvwbshy? pa pz avv lhzf av jyhjr!&#x27;\r\n    ... )  # doctest: +NORMALIZE_WHITESPACE\r\n    (7, 3129.228005747531,\r\n     &#x27;why is the caesar cipher so popular? it is too easy to crack!&#x27;)\r\n\r\n    &gt;&gt;&gt; decrypt_caesar_with_chi_squared(&#x27;crybd cdbsxq&#x27;)\r\n    (10, 233.35343938980898, &#x27;short string&#x27;)\r\n\r\n    &gt;&gt;&gt; decrypt_caesar_with_chi_squared(&#x27;Crybd Cdbsxq&#x27;, case_sensitive=True)\r\n    (10, 233.35343938980898, &#x27;Short String&#x27;)\r\n\r\n    &gt;&gt;&gt; decrypt_caesar_with_chi_squared(12)\r\n    Traceback (most recent call last):\r\n    AttributeError: &#x27;int&#x27; object has no attribute &#x27;lower&#x27;\r\n    &quot;&quot;&quot;</span>\r\n    alphabet_letters = cipher_alphabet <span class=\"hljs-keyword\">or</span> [<span class=\"hljs-built_in\">chr</span>(i) <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">97</span>, <span class=\"hljs-number\">123</span>)]\r\n\r\n    <span class=\"hljs-comment\"># If the argument is None or the user provided an empty dictionary</span>\r\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> frequencies_dict:\r\n        <span class=\"hljs-comment\"># Frequencies of letters in the english language (how much they show up)</span>\r\n        frequencies = {\r\n            <span class=\"hljs-string\">&quot;a&quot;</span>: <span class=\"hljs-number\">0.08497</span>,\r\n            <span class=\"hljs-string\">&quot;b&quot;</span>: <span class=\"hljs-number\">0.01492</span>,\r\n            <span class=\"hljs-string\">&quot;c&quot;</span>: <span class=\"hljs-number\">0.02202</span>,\r\n            <span class=\"hljs-string\">&quot;d&quot;</span>: <span class=\"hljs-number\">0.04253</span>,\r\n            <span class=\"hljs-string\">&quot;e&quot;</span>: <span class=\"hljs-number\">0.11162</span>,\r\n            <span class=\"hljs-string\">&quot;f&quot;</span>: <span class=\"hljs-number\">0.02228</span>,\r\n            <span class=\"hljs-string\">&quot;g&quot;</span>: <span class=\"hljs-number\">0.02015</span>,\r\n            <span class=\"hljs-string\">&quot;h&quot;</span>: <span class=\"hljs-number\">0.06094</span>,\r\n            <span class=\"hljs-string\">&quot;i&quot;</span>: <span class=\"hljs-number\">0.07546</span>,\r\n            <span class=\"hljs-string\">&quot;j&quot;</span>: <span class=\"hljs-number\">0.00153</span>,\r\n            <span class=\"hljs-string\">&quot;k&quot;</span>: <span class=\"hljs-number\">0.01292</span>,\r\n            <span class=\"hljs-string\">&quot;l&quot;</span>: <span class=\"hljs-number\">0.04025</span>,\r\n            <span class=\"hljs-string\">&quot;m&quot;</span>: <span class=\"hljs-number\">0.02406</span>,\r\n            <span class=\"hljs-string\">&quot;n&quot;</span>: <span class=\"hljs-number\">0.06749</span>,\r\n            <span class=\"hljs-string\">&quot;o&quot;</span>: <span class=\"hljs-number\">0.07507</span>,\r\n            <span class=\"hljs-string\">&quot;p&quot;</span>: <span class=\"hljs-number\">0.01929</span>,\r\n            <span class=\"hljs-string\">&quot;q&quot;</span>: <span class=\"hljs-number\">0.00095</span>,\r\n            <span class=\"hljs-string\">&quot;r&quot;</span>: <span class=\"hljs-number\">0.07587</span>,\r\n            <span class=\"hljs-string\">&quot;s&quot;</span>: <span class=\"hljs-number\">0.06327</span>,\r\n            <span class=\"hljs-string\">&quot;t&quot;</span>: <span class=\"hljs-number\">0.09356</span>,\r\n            <span class=\"hljs-string\">&quot;u&quot;</span>: <span class=\"hljs-number\">0.02758</span>,\r\n            <span class=\"hljs-string\">&quot;v&quot;</span>: <span class=\"hljs-number\">0.00978</span>,\r\n            <span class=\"hljs-string\">&quot;w&quot;</span>: <span class=\"hljs-number\">0.02560</span>,\r\n            <span class=\"hljs-string\">&quot;x&quot;</span>: <span class=\"hljs-number\">0.00150</span>,\r\n            <span class=\"hljs-string\">&quot;y&quot;</span>: <span class=\"hljs-number\">0.01994</span>,\r\n            <span class=\"hljs-string\">&quot;z&quot;</span>: <span class=\"hljs-number\">0.00077</span>,\r\n        }\r\n    <span class=\"hljs-keyword\">else</span>:\r\n        <span class=\"hljs-comment\"># Custom frequencies dictionary</span>\r\n        frequencies = frequencies_dict\r\n\r\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> case_sensitive:\r\n        ciphertext = ciphertext.lower()\r\n\r\n    <span class=\"hljs-comment\"># Chi squared statistic values</span>\r\n    chi_squared_statistic_values: <span class=\"hljs-built_in\">dict</span>[<span class=\"hljs-built_in\">int</span>, <span class=\"hljs-built_in\">tuple</span>[<span class=\"hljs-built_in\">float</span>, <span class=\"hljs-built_in\">str</span>]] = {}\r\n\r\n    <span class=\"hljs-comment\"># cycle through all of the shifts</span>\r\n    <span class=\"hljs-keyword\">for</span> shift <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(alphabet_letters)):\r\n        decrypted_with_shift = <span class=\"hljs-string\">&quot;&quot;</span>\r\n\r\n        <span class=\"hljs-comment\"># decrypt the message with the shift</span>\r\n        <span class=\"hljs-keyword\">for</span> letter <span class=\"hljs-keyword\">in</span> ciphertext:\r\n            <span class=\"hljs-keyword\">try</span>:\r\n                <span class=\"hljs-comment\"># Try to index the letter in the alphabet</span>\r\n                new_key = (alphabet_letters.index(letter.lower()) - shift) % <span class=\"hljs-built_in\">len</span>(\r\n                    alphabet_letters\r\n                )\r\n                decrypted_with_shift += (\r\n                    alphabet_letters[new_key].upper()\r\n                    <span class=\"hljs-keyword\">if</span> case_sensitive <span class=\"hljs-keyword\">and</span> letter.isupper()\r\n                    <span class=\"hljs-keyword\">else</span> alphabet_letters[new_key]\r\n                )\r\n            <span class=\"hljs-keyword\">except</span> ValueError:\r\n                <span class=\"hljs-comment\"># Append the character if it isn&#x27;t in the alphabet</span>\r\n                decrypted_with_shift += letter\r\n\r\n        chi_squared_statistic = <span class=\"hljs-number\">0.0</span>\r\n\r\n        <span class=\"hljs-comment\"># Loop through each letter in the decoded message with the shift</span>\r\n        <span class=\"hljs-keyword\">for</span> letter <span class=\"hljs-keyword\">in</span> decrypted_with_shift:\r\n            <span class=\"hljs-keyword\">if</span> case_sensitive:\r\n                letter = letter.lower()\r\n                <span class=\"hljs-keyword\">if</span> letter <span class=\"hljs-keyword\">in</span> frequencies:\r\n                    <span class=\"hljs-comment\"># Get the amount of times the letter occurs in the message</span>\r\n                    occurrences = decrypted_with_shift.lower().count(letter)\r\n\r\n                    <span class=\"hljs-comment\"># Get the excepcted amount of times the letter should appear based</span>\r\n                    <span class=\"hljs-comment\"># on letter frequencies</span>\r\n                    expected = frequencies[letter] * occurrences\r\n\r\n                    <span class=\"hljs-comment\"># Complete the chi squared statistic formula</span>\r\n                    chi_letter_value = ((occurrences - expected) ** <span class=\"hljs-number\">2</span>) / expected\r\n\r\n                    <span class=\"hljs-comment\"># Add the margin of error to the total chi squared statistic</span>\r\n                    chi_squared_statistic += chi_letter_value\r\n            <span class=\"hljs-keyword\">else</span>:\r\n                <span class=\"hljs-keyword\">if</span> letter.lower() <span class=\"hljs-keyword\">in</span> frequencies:\r\n                    <span class=\"hljs-comment\"># Get the amount of times the letter occurs in the message</span>\r\n                    occurrences = decrypted_with_shift.count(letter)\r\n\r\n                    <span class=\"hljs-comment\"># Get the excepcted amount of times the letter should appear based</span>\r\n                    <span class=\"hljs-comment\"># on letter frequencies</span>\r\n                    expected = frequencies[letter] * occurrences\r\n\r\n                    <span class=\"hljs-comment\"># Complete the chi squared statistic formula</span>\r\n                    chi_letter_value = ((occurrences - expected) ** <span class=\"hljs-number\">2</span>) / expected\r\n\r\n                    <span class=\"hljs-comment\"># Add the margin of error to the total chi squared statistic</span>\r\n                    chi_squared_statistic += chi_letter_value\r\n\r\n        <span class=\"hljs-comment\"># Add the data to the chi_squared_statistic_values dictionary</span>\r\n        chi_squared_statistic_values[shift] = (\r\n            chi_squared_statistic,\r\n            decrypted_with_shift,\r\n        )\r\n\r\n    <span class=\"hljs-comment\"># Get the most likely cipher by finding the cipher with the smallest chi squared</span>\r\n    <span class=\"hljs-comment\"># statistic</span>\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">chi_squared_statistic_values_sorting_key</span>(<span class=\"hljs-params\">key: <span class=\"hljs-built_in\">int</span></span>) -&gt; <span class=\"hljs-built_in\">tuple</span>[<span class=\"hljs-built_in\">float</span>, <span class=\"hljs-built_in\">str</span>]:\r\n        <span class=\"hljs-keyword\">return</span> chi_squared_statistic_values[key]\r\n\r\n    most_likely_cipher: <span class=\"hljs-built_in\">int</span> = <span class=\"hljs-built_in\">min</span>(\r\n        chi_squared_statistic_values,\r\n        key=chi_squared_statistic_values_sorting_key,\r\n    )\r\n\r\n    <span class=\"hljs-comment\"># Get all the data from the most likely cipher (key, decoded message)</span>\r\n    (\r\n        most_likely_cipher_chi_squared_value,\r\n        decoded_most_likely_cipher,\r\n    ) = chi_squared_statistic_values[most_likely_cipher]\r\n\r\n    <span class=\"hljs-comment\"># Return the data on the most likely shift</span>\r\n    <span class=\"hljs-keyword\">return</span> (\r\n        most_likely_cipher,\r\n        most_likely_cipher_chi_squared_value,\r\n        decoded_most_likely_cipher,\r\n    )\r\n"
    }
  },
  "contributors": [
    {
      "name": "Aniruddha Bhattacharjee",
      "email": "aniruddha97bhatt@gmail.com",
      "commits": 1
    },
    {
      "name": "happiestbee",
      "email": "87628038+happiestbee@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "Erwin Junge",
      "email": "erwin@junge.nl",
      "commits": 1
    },
    {
      "name": "Dhruv Manilawala",
      "email": "dhruvmanila@gmail.com",
      "commits": 1
    },
    {
      "name": "Jenia Dysin",
      "email": "jenia90@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "Maxim R",
      "email": "49735721+mrmaxguns@users.noreply.github.com",
      "commits": 1
    },
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 2
    }
  ],
  "explanationUrl": {}
}