{
  "slug": "2048",
  "name": "2048",
  "categories": [
    "others"
  ],
  "body": {},
  "implementations": {
    "aarch64_assembly": {
      "dir": "misc\\2048.s",
      "url": "https://github.com/TheAlgorithms/aarch64_assembly/tree/master/misc\\2048.s",
      "code": "<span class=\"hljs-comment\">/* ARM assembly AARCH64 Raspberry PI 3B */</span>\r\n<span class=\"hljs-comment\">/*  program 2048_64.s   */</span> \r\n \r\n<span class=\"hljs-comment\">/*******************************************/</span>\r\n<span class=\"hljs-comment\">/* Constantes file                         */</span>\r\n<span class=\"hljs-comment\">/*******************************************/</span>\r\n<span class=\"hljs-comment\">/* for this file see task include a file in language AArch64 assembly*/</span>\r\n<span class=\"hljs-symbol\">.include</span> <span class=\"hljs-string\">&quot;../includeConstantesARM64.inc&quot;</span>\r\n<span class=\"hljs-symbol\">.equ</span> SIZE,       <span class=\"hljs-number\">4</span>       \r\n<span class=\"hljs-symbol\">.equ</span> TOTAL,      <span class=\"hljs-number\">2048</span>\r\n<span class=\"hljs-symbol\">.equ</span> BUFFERSIZE, <span class=\"hljs-number\">80</span>\r\n \r\n<span class=\"hljs-symbol\">.equ</span> KEYSIZE,    <span class=\"hljs-number\">8</span>\r\n<span class=\"hljs-symbol\">.equ</span> IOCTL,     <span class=\"hljs-number\">0x1D</span>  <span class=\"hljs-comment\">// Linux syscall</span>\r\n<span class=\"hljs-symbol\">.equ</span> SIGACTION, <span class=\"hljs-number\">0x86</span>  <span class=\"hljs-comment\">// Linux syscall</span>\r\n<span class=\"hljs-symbol\">.equ</span> SYSPOLL,   <span class=\"hljs-number\">0x16</span>  <span class=\"hljs-comment\">// Linux syscall</span>\r\n<span class=\"hljs-symbol\">.equ</span> CREATPOLL, <span class=\"hljs-number\">0x14</span>  <span class=\"hljs-comment\">// Linux syscall</span>\r\n<span class=\"hljs-symbol\">.equ</span> CTLPOLL,   <span class=\"hljs-number\">0x15</span>  <span class=\"hljs-comment\">// Linux syscall</span>\r\n \r\n<span class=\"hljs-symbol\">.equ</span> TCGETS,    <span class=\"hljs-number\">0x5401</span>\r\n<span class=\"hljs-symbol\">.equ</span> TCSETS,    <span class=\"hljs-number\">0x5402</span>\r\n<span class=\"hljs-symbol\">.equ</span> ICANON,    <span class=\"hljs-number\">2</span>\r\n<span class=\"hljs-symbol\">.equ</span> ECHO,     <span class=\"hljs-number\">10</span>\r\n<span class=\"hljs-symbol\">.equ</span> POLLIN,    <span class=\"hljs-number\">1</span>\r\n<span class=\"hljs-symbol\">.equ</span> EPOLL_CTL_ADD,    <span class=\"hljs-number\">1</span>\r\n \r\n<span class=\"hljs-symbol\">.equ</span> SIGINT,   <span class=\"hljs-number\">2</span>      <span class=\"hljs-comment\">// Issued if the user sends an interrupt signal (Ctrl + C)</span>\r\n<span class=\"hljs-symbol\">.equ</span> SIGQUIT,  <span class=\"hljs-number\">3</span>      <span class=\"hljs-comment\">// Issued if the user sends a quit signal (Ctrl + D)</span>\r\n<span class=\"hljs-symbol\">.equ</span> SIGTERM, <span class=\"hljs-number\">15</span>      <span class=\"hljs-comment\">// Software termination signal (sent by kill by default)</span>\r\n<span class=\"hljs-symbol\">.equ</span> SIGTTOU, <span class=\"hljs-number\">22</span>\r\n \r\n<span class=\"hljs-comment\">/*******************************************/</span>\r\n<span class=\"hljs-comment\">/* Structures                               */</span>\r\n<span class=\"hljs-comment\">/********************************************/</span>\r\n<span class=\"hljs-comment\">/* structure termios see doc linux*/</span>\r\n    .struct  <span class=\"hljs-number\">0</span>\r\n<span class=\"hljs-symbol\">term_c_iflag:</span>                    <span class=\"hljs-comment\">// input modes</span>\r\n    .struct  term_c_iflag + <span class=\"hljs-number\">4</span> \r\n<span class=\"hljs-symbol\">term_c_oflag:</span>                    <span class=\"hljs-comment\">// output modes</span>\r\n    .struct  term_c_oflag + <span class=\"hljs-number\">4</span> \r\n<span class=\"hljs-symbol\">term_c_cflag:</span>                    <span class=\"hljs-comment\">// control modes</span>\r\n    .struct  term_c_cflag + <span class=\"hljs-number\">4</span> \r\n<span class=\"hljs-symbol\">term_c_lflag:</span>                    <span class=\"hljs-comment\">// local modes</span>\r\n    .struct  term_c_lflag + <span class=\"hljs-number\">4</span> \r\n<span class=\"hljs-symbol\">term_c_cc:</span>                       <span class=\"hljs-comment\">// special characters</span>\r\n    .struct  term_c_cc + <span class=\"hljs-number\">40</span>      <span class=\"hljs-comment\">// see length if necessary </span>\r\n<span class=\"hljs-symbol\">term_fin:</span>\r\n \r\n<span class=\"hljs-comment\">/* structure sigaction see doc linux */</span>\r\n    .struct  <span class=\"hljs-number\">0</span>\r\n<span class=\"hljs-symbol\">sa_handler:</span>\r\n    .struct  sa_handler + <span class=\"hljs-number\">8</span> \r\n<span class=\"hljs-symbol\">sa_mask:</span>\r\n    .struct  sa_mask + <span class=\"hljs-number\">8</span> \r\n<span class=\"hljs-symbol\">sa_flags:</span>\r\n    .struct  sa_flags + <span class=\"hljs-number\">8</span>\r\n<span class=\"hljs-symbol\">sa_sigaction:</span>\r\n    .struct  sa_sigaction + <span class=\"hljs-number\">8</span>\r\n<span class=\"hljs-symbol\">sa_fin:</span>\r\n \r\n<span class=\"hljs-comment\">/* structure poll see doc linux */</span>\r\n    .struct  <span class=\"hljs-number\">0</span>\r\n<span class=\"hljs-symbol\">poll_event:</span>                        <span class=\"hljs-comment\">//  events mask</span>\r\n    .struct  poll_event + <span class=\"hljs-number\">8</span>\r\n<span class=\"hljs-symbol\">poll_fd:</span>                           <span class=\"hljs-comment\">// events returned</span>\r\n    .struct  poll_fd  + <span class=\"hljs-number\">8</span>\r\n<span class=\"hljs-symbol\">poll_fin:</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-comment\">/* Initialized data              */</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-symbol\">.data</span>\r\n<span class=\"hljs-symbol\">szMessOK:</span>           <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;Bravo !! You win. \\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessNotOK:</span>        <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;You lost !! \\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessNewGame:</span>      <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;New game (y/n) ? \\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessErreur:</span>       <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;Error detected.\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessErrInitTerm:</span>  <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;Error terminal init.\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessErrInitPoll:</span>  <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;Error poll init.\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessErreurKey:</span>    <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;Error read key.\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMessErr:</span>          <span class=\"hljs-meta\">.asciz</span>    <span class=\"hljs-string\">&quot;Error code hexa : @ d√©cimal : @ \\n&quot;</span>\r\n<span class=\"hljs-symbol\">szCarriageReturn:</span>   <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szMess0:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;      &quot;</span>\r\n<span class=\"hljs-symbol\">szMess2:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;   2  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess4:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;   4  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess8:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;   8  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess16:</span>           <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;  16  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess32:</span>           <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;  32  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess64:</span>           <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;  64  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess128:</span>          <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot; 128  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess256:</span>          <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot; 256  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess512:</span>          <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot; 512  &quot;</span>\r\n<span class=\"hljs-symbol\">szMess1024:</span>         <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot; 1024 &quot;</span>\r\n<span class=\"hljs-symbol\">szMess2048:</span>         <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot; 2048 &quot;</span>\r\n<span class=\"hljs-symbol\">szCleax1:</span>           <span class=\"hljs-meta\">.byte</span> <span class=\"hljs-number\">0x1B</span> \r\n                    <span class=\"hljs-meta\">.byte</span> <span class=\"hljs-string\">&#x27;c&#x27;</span>           <span class=\"hljs-comment\">// other console clear</span>\r\n                    <span class=\"hljs-meta\">.byte</span> <span class=\"hljs-number\">0</span>\r\n \r\n<span class=\"hljs-symbol\">szLineH:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;-----------------------------\\n&quot;</span>\r\n<span class=\"hljs-symbol\">szLineV:</span>            <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;|&quot;</span>\r\n<span class=\"hljs-symbol\">szLineVT:</span>           <span class=\"hljs-meta\">.asciz</span> <span class=\"hljs-string\">&quot;|      |      |      |      |\\n&quot;</span>\r\n<span class=\"hljs-symbol\">.align</span> <span class=\"hljs-number\">4</span>\r\n<span class=\"hljs-symbol\">qGraine:</span>            .quad <span class=\"hljs-number\">123456</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-comment\">/* UnInitialized data            */</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-symbol\">.bss</span>\r\n<span class=\"hljs-symbol\">.align</span> <span class=\"hljs-number\">4</span>\r\n<span class=\"hljs-symbol\">sZoneConv:</span>      <span class=\"hljs-meta\">.skip</span> <span class=\"hljs-number\">24</span>\r\n<span class=\"hljs-symbol\">sBuffer:</span>        <span class=\"hljs-meta\">.skip</span> BUFFERSIZE\r\n<span class=\"hljs-symbol\">qTbCase:</span>        <span class=\"hljs-meta\">.skip</span> <span class=\"hljs-number\">8</span> * SIZE * SIZE\r\n<span class=\"hljs-symbol\">qEnd:</span>           <span class=\"hljs-meta\">.skip</span> <span class=\"hljs-number\">8</span>                        <span class=\"hljs-comment\">// 0 loop  1 = end loop</span>\r\n<span class=\"hljs-symbol\">qTouche:</span>        <span class=\"hljs-meta\">.skip</span> KEYSIZE                  <span class=\"hljs-comment\">// value key pressed</span>\r\n<span class=\"hljs-symbol\">stOldtio:</span>       <span class=\"hljs-meta\">.skip</span> term_fin                 <span class=\"hljs-comment\">// old terminal state</span>\r\n<span class=\"hljs-symbol\">stCurtio:</span>       <span class=\"hljs-meta\">.skip</span> term_fin                 <span class=\"hljs-comment\">// current terminal state</span>\r\n<span class=\"hljs-symbol\">stSigAction:</span>    <span class=\"hljs-meta\">.skip</span> sa_fin                   <span class=\"hljs-comment\">// area signal structure</span>\r\n<span class=\"hljs-symbol\">stSigAction1:</span>   <span class=\"hljs-meta\">.skip</span> sa_fin\r\n<span class=\"hljs-symbol\">stSigAction2:</span>   <span class=\"hljs-meta\">.skip</span> sa_fin\r\n<span class=\"hljs-symbol\">stSigAction3:</span>   <span class=\"hljs-meta\">.skip</span> sa_fin\r\n<span class=\"hljs-symbol\">stPoll1:</span>        <span class=\"hljs-meta\">.skip</span> poll_fin                 <span class=\"hljs-comment\">// area poll structure</span>\r\n<span class=\"hljs-symbol\">stPoll2:</span>        <span class=\"hljs-meta\">.skip</span> poll_fin\r\n<span class=\"hljs-symbol\">stevents:</span>       <span class=\"hljs-meta\">.skip</span> <span class=\"hljs-number\">16</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-comment\">/*  code section                 */</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-symbol\">.text</span>\r\n<span class=\"hljs-symbol\">.global</span> main\r\n<span class=\"hljs-symbol\">main:</span>                                <span class=\"hljs-comment\">// entry of program </span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">bl</span> initTerm                      <span class=\"hljs-comment\">// terminal init</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>                         <span class=\"hljs-comment\">// error ?</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">100</span>f\r\n    <span class=\"hljs-keyword\">bl</span> initPoll                      <span class=\"hljs-comment\">// epoll instance init</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">99</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x22,x0                        <span class=\"hljs-comment\">// save epfd</span>\r\n<span class=\"hljs-number\">1</span>:                                    <span class=\"hljs-comment\">// begin game loop</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCleax1\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">bl</span> razTable\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">bl</span> addDigit   \r\n    <span class=\"hljs-keyword\">cmp</span> x0,#-<span class=\"hljs-number\">1</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">5</span>f                            <span class=\"hljs-comment\">// end game</span>\r\n    <span class=\"hljs-keyword\">bl</span> displayGame\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,x22\r\n    <span class=\"hljs-keyword\">bl</span> waitKey\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>b\r\n    <span class=\"hljs-keyword\">bl</span> readKey\r\n    <span class=\"hljs-keyword\">cmp</span> x0,#-<span class=\"hljs-number\">1</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">99</span>f                          <span class=\"hljs-comment\">// error</span>\r\n    <span class=\"hljs-keyword\">bl</span> keyMove\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>b                            <span class=\"hljs-comment\">// no change -&gt; loop</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#2</span>                         <span class=\"hljs-comment\">// last addition = 2048 ?</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x0,#-<span class=\"hljs-number\">1</span>                        <span class=\"hljs-comment\">// quit ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">2</span>b                            <span class=\"hljs-comment\">// loop</span>\r\n \r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">10</span>f\r\n<span class=\"hljs-number\">4</span>:                                    <span class=\"hljs-comment\">// last addition = 2048 </span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMessOK\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">10</span>f\r\n<span class=\"hljs-number\">5</span>:                                    <span class=\"hljs-comment\">// display message no solution</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMessNotOK\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n \r\n<span class=\"hljs-number\">10</span>:                                   <span class=\"hljs-comment\">// display new game ?</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCarriageReturn\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMessNewGame\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n<span class=\"hljs-number\">11</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,x22\r\n    <span class=\"hljs-keyword\">bl</span> waitKey\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">11</span>b\r\n    <span class=\"hljs-keyword\">bl</span> readKey\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrqTouche\r\n    <span class=\"hljs-keyword\">ldrb</span> w0,[x0]\r\n    <span class=\"hljs-keyword\">cmp</span> w0,#<span class=\"hljs-string\">&#x27;y&#x27;</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">cmp</span> w0,#<span class=\"hljs-string\">&#x27;Y&#x27;</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">1</span>b\r\n<span class=\"hljs-number\">99</span>:\r\n    <span class=\"hljs-keyword\">bl</span> restauTerm                     <span class=\"hljs-comment\">// terminal restaur</span>\r\n<span class=\"hljs-number\">100</span>:                                  <span class=\"hljs-comment\">// standard end of the program </span>\r\n    <span class=\"hljs-keyword\">mov</span> x0, <span class=\"hljs-number\">#0</span>                        <span class=\"hljs-comment\">// return code</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8, <span class=\"hljs-symbol\">#EXIT</span>                     <span class=\"hljs-comment\">// request to exit program</span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">#0</span>                            <span class=\"hljs-comment\">// perform the system call</span>\r\n \r\n<span class=\"hljs-symbol\">qAdrszCarriageReturn:</span>     .quad szCarriageReturn\r\n<span class=\"hljs-symbol\">qAdrszMessNotOK:</span>          .quad szMessNotOK\r\n<span class=\"hljs-symbol\">qAdrszMessOK:</span>             .quad szMessOK\r\n<span class=\"hljs-symbol\">qAdrszMessNewGame:</span>        .quad szMessNewGame\r\n<span class=\"hljs-symbol\">qAdrsZoneConv:</span>            .quad sZoneConv\r\n<span class=\"hljs-symbol\">qAdrszCleax1:</span>             .quad szCleax1\r\n<span class=\"hljs-symbol\">qAdrszMessErrInitTerm:</span>    .quad szMessErrInitTerm\r\n<span class=\"hljs-symbol\">qAdrszMessErrInitPoll:</span>    .quad szMessErrInitPoll\r\n<span class=\"hljs-symbol\">qAdrszMessErreurKey:</span>      .quad szMessErreurKey\r\n<span class=\"hljs-symbol\">qAdrstOldtio:</span>             .quad stOldtio\r\n<span class=\"hljs-symbol\">qAdrstCurtio:</span>             .quad stCurtio\r\n<span class=\"hljs-symbol\">qAdrstSigAction:</span>          .quad stSigAction\r\n<span class=\"hljs-symbol\">qAdrstSigAction1:</span>         .quad stSigAction1\r\n<span class=\"hljs-symbol\">qAdrSIG_IGN:</span>              .quad <span class=\"hljs-number\">1</span>\r\n<span class=\"hljs-symbol\">qAdrqEnd:</span>                 .quad qEnd\r\n<span class=\"hljs-symbol\">qAdrqTouche:</span>              .quad qTouche\r\n<span class=\"hljs-symbol\">qAdrstevents:</span>             .quad stevents\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*     raz table cases                                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-symbol\">razTable:</span>\r\n    stp x0,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!     <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x1,x2,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!     <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">str</span> xzr,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span> * SIZE\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x1,x2,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>       <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x0,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>       <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*     key move                                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 contains key value               */</span>\r\n<span class=\"hljs-symbol\">keyMove:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!     <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">lsr</span> x0,x0,<span class=\"hljs-number\">#16</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0x42</span>                  <span class=\"hljs-comment\">// down arrow </span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">1</span>f\r\n    <span class=\"hljs-keyword\">bl</span> moveDown\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0x41</span>                  <span class=\"hljs-comment\">// high arrow</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">2</span>f\r\n    <span class=\"hljs-keyword\">bl</span> moveUp\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0x43</span>                  <span class=\"hljs-comment\">// right arrow</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">3</span>f\r\n    <span class=\"hljs-keyword\">bl</span> moveRight\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0x44</span>                  <span class=\"hljs-comment\">// left arrow</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">bl</span> moveLeft\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrqTouche\r\n    <span class=\"hljs-keyword\">ldrb</span> w0,[x0]\r\n    <span class=\"hljs-keyword\">cmp</span> w0,#<span class=\"hljs-string\">&#x27;q&#x27;</span>                   <span class=\"hljs-comment\">// quit game</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">5</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x0,#-<span class=\"hljs-number\">1</span>\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">5</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> w0,#<span class=\"hljs-string\">&#x27;Q&#x27;</span>                   <span class=\"hljs-comment\">// quit game</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">100</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x0,#-<span class=\"hljs-number\">1</span>\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n \r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>       <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*           move left                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 return -1 if ok     */</span>\r\n<span class=\"hljs-symbol\">moveLeft:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x4,x5,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x6,x7,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x8,x9,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x10,x11,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!        <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// top move Ok</span>\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// line indice</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x6,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// counter empty case</span>\r\n    <span class=\"hljs-keyword\">mov</span> x7,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// first digit</span>\r\n    <span class=\"hljs-keyword\">mov</span> x10,<span class=\"hljs-number\">#0</span>                  <span class=\"hljs-comment\">// last digit to add</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// column indice</span>\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">lsl</span> x5,x2,<span class=\"hljs-number\">#2</span>                <span class=\"hljs-comment\">// change this if size &lt;&gt; 4</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x3                <span class=\"hljs-comment\">// compute table indice</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#0</span>\r\n    cinc x6,x6,eq               <span class=\"hljs-comment\">// positions vides</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">5</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>f                      <span class=\"hljs-comment\">// no empty left case</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x8,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// raz digit</span>\r\n    <span class=\"hljs-keyword\">sub</span> x5,x5,x6\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// and store to left empty position</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>                   <span class=\"hljs-comment\">// move Ok</span>\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x7,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// first digit</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x10,x4                  <span class=\"hljs-comment\">// prec digit have to add </span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">sub</span> x8,x5,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// prec digit </span>\r\n    <span class=\"hljs-keyword\">ldr</span> x9,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,x9                   <span class=\"hljs-comment\">// equal ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x10,x4                  <span class=\"hljs-comment\">// save digit </span>\r\n    <span class=\"hljs-keyword\">add</span> x4,x4,x9                <span class=\"hljs-comment\">// yes -&gt; add</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-symbol\">#TOTAL</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">6</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x4,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x6,x6,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// empty case + 1</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>                   <span class=\"hljs-comment\">// move Ok</span>\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">add</span> x7,x7,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// no first digit</span>\r\n \r\n<span class=\"hljs-number\">5</span>:                              <span class=\"hljs-comment\">// and loop</span>\r\n    <span class=\"hljs-keyword\">add</span> x3,x3,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x3,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">2</span>b\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">6</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#2</span>                   <span class=\"hljs-comment\">// total = 2048</span>\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x10,x11,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>         <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x8,x9,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x6,x7,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x4,x5,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*           move right                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 return -1 if ok     */</span>\r\n<span class=\"hljs-symbol\">moveRight:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x4,x5,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x6,x7,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x8,x9,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x10,x11,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!        <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x7,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x10,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-symbol\">#SIZE</span>-<span class=\"hljs-number\">1</span>\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">lsl</span> x5,x2,<span class=\"hljs-number\">#2</span>                  <span class=\"hljs-comment\">// change this if size &lt;&gt; 4</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x3\r\n    <span class=\"hljs-keyword\">ldr</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#0</span>\r\n    cinc x6,x6,eq               <span class=\"hljs-comment\">// positions vides</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">5</span>f\r\n \r\n    <span class=\"hljs-keyword\">cmp</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>f                      <span class=\"hljs-comment\">// no empty right case</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x0,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// raz digit</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x6\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// and store to right empty position</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x7,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// first digit</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">add</span> x8,x5,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// next digit </span>\r\n    <span class=\"hljs-keyword\">ldr</span> x9,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,x9                   <span class=\"hljs-comment\">// equal ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x10,x4\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x10,x4\r\n    <span class=\"hljs-keyword\">add</span> x4,x4,x9                <span class=\"hljs-comment\">// yes -&gt; add</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-symbol\">#TOTAL</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">6</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x4,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x6,x6,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// empty case + 1</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">add</span> x7,x7,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// no first digit</span>\r\n \r\n<span class=\"hljs-number\">5</span>:                              <span class=\"hljs-comment\">// and loop</span>\r\n    <span class=\"hljs-keyword\">sub</span> x3,x3,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x3,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">bge</span> <span class=\"hljs-number\">2</span>b\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">6</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#2</span>\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x10,x11,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>         <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x8,x9,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x6,x7,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x4,x5,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*           move down                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 return -1 if ok     */</span>\r\n<span class=\"hljs-symbol\">moveDown:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x4,x5,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x6,x7,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x8,x9,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x10,x11,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!        <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x7,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x10,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-symbol\">#SIZE</span>-<span class=\"hljs-number\">1</span>\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">lsl</span> x5,x2,<span class=\"hljs-number\">#2</span>                  <span class=\"hljs-comment\">// change this if size &lt;&gt; 4</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x3\r\n    <span class=\"hljs-keyword\">ldr</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#0</span>\r\n    cinc x6,x6,eq               <span class=\"hljs-comment\">// positions vides</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">5</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>f                      <span class=\"hljs-comment\">// no empty right case</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x0,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// raz digit</span>\r\n    <span class=\"hljs-keyword\">lsl</span> x0,x6,<span class=\"hljs-number\">#2</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x0\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// and store to right empty position</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x7,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// first digit</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">add</span> x8,x5,<span class=\"hljs-symbol\">#SIZE</span>                <span class=\"hljs-comment\">// down digit </span>\r\n    <span class=\"hljs-keyword\">ldr</span> x9,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,x9                   <span class=\"hljs-comment\">// equal ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x10,x4\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x10,x4\r\n    <span class=\"hljs-keyword\">add</span> x4,x4,x9                <span class=\"hljs-comment\">// yes -&gt; add</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-symbol\">#TOTAL</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">6</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x4,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x6,x6,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// empty case + 1</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">add</span> x7,x7,<span class=\"hljs-number\">#1</span>                   <span class=\"hljs-comment\">// no first digit</span>\r\n \r\n<span class=\"hljs-number\">5</span>:                           <span class=\"hljs-comment\">// and loop</span>\r\n    <span class=\"hljs-keyword\">sub</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">bge</span> <span class=\"hljs-number\">2</span>b\r\n    <span class=\"hljs-keyword\">add</span> x3,x3,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x3,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">6</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#2</span>\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x10,x11,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>         <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x8,x9,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x6,x7,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x4,x5,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*           move up                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 return -1 if ok     */</span>\r\n<span class=\"hljs-symbol\">moveUp:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x4,x5,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x6,x7,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x8,x9,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x10,x11,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!        <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x7,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x10,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">lsl</span> x5,x2,<span class=\"hljs-number\">#2</span>                  <span class=\"hljs-comment\">// change this if size &lt;&gt; 4</span>\r\n    <span class=\"hljs-keyword\">add</span> x5,x5,x3\r\n    <span class=\"hljs-keyword\">ldr</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#0</span>\r\n    cinc x6,x6,eq               <span class=\"hljs-comment\">// positions vides</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">5</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x6,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">3</span>f                      <span class=\"hljs-comment\">// no empty right case</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x0,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// raz digit</span>\r\n    <span class=\"hljs-keyword\">lsl</span> x0,x6,<span class=\"hljs-number\">#2</span>\r\n    <span class=\"hljs-keyword\">sub</span> x5,x5,x0\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]       <span class=\"hljs-comment\">// and store to right empty position</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x7,<span class=\"hljs-number\">#0</span>                   <span class=\"hljs-comment\">// first digit</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">sub</span> x8,x5,<span class=\"hljs-symbol\">#SIZE</span>             <span class=\"hljs-comment\">// up digit </span>\r\n    <span class=\"hljs-keyword\">ldr</span> x9,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,x9                   <span class=\"hljs-comment\">// equal ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x10,x4\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x10,x4\r\n    <span class=\"hljs-keyword\">add</span> x4,x4,x9                <span class=\"hljs-comment\">// yes -&gt; add</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x8,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-symbol\">#TOTAL</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">6</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x4,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">str</span> x4,[x1,x5,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x6,x6,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// empty case + 1</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">add</span> x7,x7,<span class=\"hljs-number\">#1</span>                <span class=\"hljs-comment\">// no first digit</span>\r\n \r\n<span class=\"hljs-number\">5</span>:                              <span class=\"hljs-comment\">// and loop</span>\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">2</span>b\r\n    <span class=\"hljs-keyword\">add</span> x3,x3,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x3,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">6</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#2</span>\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x10,x11,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>         <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x8,x9,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x6,x7,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x4,x5,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*           add new digit on game                                   */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 return -1 if ok     */</span>\r\n<span class=\"hljs-symbol\">addDigit:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x4,x5,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">sub</span> <span class=\"hljs-built_in\">sp</span>,<span class=\"hljs-built_in\">sp</span>,<span class=\"hljs-number\">#8</span> * SIZE*SIZE\r\n    <span class=\"hljs-keyword\">mov</span> <span class=\"hljs-built_in\">fp</span>,<span class=\"hljs-built_in\">sp</span>\r\n \r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#100</span>\r\n    <span class=\"hljs-keyword\">bl</span> genereraleas\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#10</span>\r\n    <span class=\"hljs-keyword\">mov</span> x1,<span class=\"hljs-number\">#4</span>\r\n    <span class=\"hljs-keyword\">mov</span> x5,<span class=\"hljs-number\">#2</span>\r\n    csel x5,x5,x1,ge\r\n   <span class=\"hljs-comment\">// movlt x5,#4</span>\r\n    <span class=\"hljs-comment\">//movge x5,#2</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x4,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:  \r\n    <span class=\"hljs-keyword\">ldr</span> x2,[x1,x3,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">3</span>]\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">2</span>f\r\n    <span class=\"hljs-keyword\">str</span> x3,[<span class=\"hljs-built_in\">fp</span>,x4,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">3</span>]\r\n    <span class=\"hljs-keyword\">add</span> x4,x4,<span class=\"hljs-number\">#1</span>\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">add</span> x3,x3,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x3,<span class=\"hljs-symbol\">#SIZE</span>*SIZE\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#0</span>                 <span class=\"hljs-comment\">// no empty case</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">cmp</span> x4,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">3</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x2,[<span class=\"hljs-built_in\">fp</span>]               <span class=\"hljs-comment\">// one case</span>\r\n    <span class=\"hljs-keyword\">str</span> x5,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">3</span>]\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">3</span>:                            <span class=\"hljs-comment\">// multiple case</span>\r\n    <span class=\"hljs-keyword\">sub</span> x0,x4,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">bl</span> genereraleas\r\n    <span class=\"hljs-keyword\">ldr</span> x2,[<span class=\"hljs-built_in\">fp</span>,x0,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">3</span>]\r\n    <span class=\"hljs-keyword\">str</span> x5,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">3</span>]\r\n    <span class=\"hljs-keyword\">mov</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">mov</span> x0,#-<span class=\"hljs-number\">1</span>\r\n<span class=\"hljs-number\">100</span>:\r\n    <span class=\"hljs-keyword\">add</span> <span class=\"hljs-built_in\">sp</span>,<span class=\"hljs-built_in\">sp</span>,<span class=\"hljs-number\">#8</span>*  (SIZE*SIZE)  <span class=\"hljs-comment\">// stack alignement</span>\r\n    ldp x4,x5,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-symbol\">qAdrqTbCase:</span>         .quad qTbCase\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*            display game                                      */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-symbol\">displayGame:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCleax1\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineH\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqTbCase\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">#0</span>\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x0,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">bl</span> digitString\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">1</span>b\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCarriageReturn\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineH\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x0,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">bl</span> digitString\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>*<span class=\"hljs-number\">2</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">2</span>b\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCarriageReturn\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineH\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x0,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">bl</span> digitString\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>*<span class=\"hljs-number\">3</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">3</span>b\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCarriageReturn\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineH\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x0,[x1,x2,<span class=\"hljs-keyword\">lsl</span> <span class=\"hljs-number\">#3</span>]\r\n    <span class=\"hljs-keyword\">bl</span> digitString\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineV\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,<span class=\"hljs-number\">#1</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x2,<span class=\"hljs-symbol\">#SIZE</span>*<span class=\"hljs-number\">4</span>\r\n    <span class=\"hljs-keyword\">blt</span> <span class=\"hljs-number\">4</span>b\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszCarriageReturn\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineVT\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszLineH\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n \r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-symbol\">qAdrszLineH:</span>         .quad szLineH\r\n<span class=\"hljs-symbol\">qAdrszLineV:</span>         .quad szLineV\r\n<span class=\"hljs-symbol\">qAdrszLineVT:</span>        .quad szLineVT\r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*            digits string                                       */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 contains number */</span>\r\n<span class=\"hljs-comment\">/* x0 return address string */</span>\r\n<span class=\"hljs-symbol\">digitString:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!          <span class=\"hljs-comment\">// save  registres</span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">1</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess0\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">1</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#2</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">2</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess2\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">2</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#4</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">3</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess4\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">3</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#8</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">4</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess8\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">4</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#16</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">5</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess16\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">5</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#32</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">6</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess32\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">6</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#64</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">7</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess64\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">7</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#128</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">8</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess128\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">8</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#256</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">9</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess256\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">9</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#512</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">10</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess512\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">10</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#1024</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">11</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess1024\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">11</span>:\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#2048</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">12</span>f\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMess2048\r\n    <span class=\"hljs-keyword\">b</span> <span class=\"hljs-number\">100</span>f\r\n<span class=\"hljs-number\">12</span>:\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrszMessErreur                       <span class=\"hljs-comment\">// error message</span>\r\n    <span class=\"hljs-keyword\">bl</span>   displayError\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>           <span class=\"hljs-comment\">// restaur des  2 registres</span>\r\n    ret\r\n<span class=\"hljs-symbol\">qAdrszMess0:</span>          .quad szMess0\r\n<span class=\"hljs-symbol\">qAdrszMess2:</span>          .quad szMess2\r\n<span class=\"hljs-symbol\">qAdrszMess4:</span>          .quad szMess4\r\n<span class=\"hljs-symbol\">qAdrszMess8:</span>          .quad szMess8\r\n<span class=\"hljs-symbol\">qAdrszMess16:</span>         .quad szMess16\r\n<span class=\"hljs-symbol\">qAdrszMess32:</span>         .quad szMess32\r\n<span class=\"hljs-symbol\">qAdrszMess64:</span>         .quad szMess64\r\n<span class=\"hljs-symbol\">qAdrszMess128:</span>        .quad szMess128\r\n<span class=\"hljs-symbol\">qAdrszMess256:</span>        .quad szMess256\r\n<span class=\"hljs-symbol\">qAdrszMess512:</span>        .quad szMess512\r\n<span class=\"hljs-symbol\">qAdrszMess1024:</span>       .quad szMess1024\r\n<span class=\"hljs-symbol\">qAdrszMess2048:</span>        .quad szMess2048\r\n \r\n<span class=\"hljs-comment\">//qAdrsBuffer:         .quad sBuffer</span>\r\n<span class=\"hljs-symbol\">qAdrszMessErreur</span> :        .quad szMessErreur \r\n \r\n<span class=\"hljs-comment\">/***************************************************/</span>\r\n<span class=\"hljs-comment\">/*   Generation random number                  */</span>\r\n<span class=\"hljs-comment\">/***************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 contains limit  */</span>\r\n<span class=\"hljs-symbol\">genereraleas:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!            <span class=\"hljs-comment\">// save  registers</span>\r\n    stp x2,x3,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!            <span class=\"hljs-comment\">// save  registers</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrqGraine\r\n    <span class=\"hljs-keyword\">ldr</span> x2,[x1]\r\n    <span class=\"hljs-keyword\">ldr</span> x3,qNbDep1\r\n    <span class=\"hljs-keyword\">mul</span> x2,x3,x2\r\n    <span class=\"hljs-keyword\">ldr</span> x3,qNbDep2\r\n    <span class=\"hljs-keyword\">add</span> x2,x2,x3\r\n    <span class=\"hljs-keyword\">str</span> x2,[x1]                    <span class=\"hljs-comment\">// maj de la graine pour l appel suivant </span>\r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">#0</span>\r\n    <span class=\"hljs-keyword\">beq</span> <span class=\"hljs-number\">100</span>f\r\n    udiv x3,x2,x0\r\n    msub x0,x3,x0,x2               <span class=\"hljs-comment\">// r√©sult = remainder</span>\r\n \r\n<span class=\"hljs-number\">100</span>:                               <span class=\"hljs-comment\">// end function</span>\r\n    ldp x2,x3,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>              <span class=\"hljs-comment\">// restaur  2 registers</span>\r\n    ldp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>              <span class=\"hljs-comment\">// restaur  2 registers</span>\r\n    ret                            <span class=\"hljs-comment\">// return to address lr x30</span>\r\n<span class=\"hljs-comment\">/*****************************************************/</span>\r\n<span class=\"hljs-symbol\">qAdrqGraine:</span> .quad qGraine\r\n<span class=\"hljs-symbol\">qNbDep1:</span>     .quad <span class=\"hljs-number\">0x0019660d</span>\r\n<span class=\"hljs-symbol\">qNbDep2:</span>     .quad <span class=\"hljs-number\">0x3c6ef35f</span>\r\n \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-comment\">/*     traitement du signal                                       */</span> \r\n<span class=\"hljs-comment\">/******************************************************************/</span>\r\n<span class=\"hljs-symbol\">sighandler:</span>\r\n    stp x0,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!            <span class=\"hljs-comment\">// save  registers</span>\r\n    <span class=\"hljs-keyword\">str</span> x1,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]! \r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrqEnd\r\n    <span class=\"hljs-keyword\">mov</span> x1,<span class=\"hljs-number\">#1</span>                      <span class=\"hljs-comment\">// maj zone end</span>\r\n    <span class=\"hljs-keyword\">str</span> x1,[x0]\r\n    <span class=\"hljs-keyword\">ldr</span> x1,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>\r\n    ldp x0,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>              <span class=\"hljs-comment\">// restaur  2 registers</span>\r\n    ret                            <span class=\"hljs-comment\">// return to address lr x30</span>\r\n<span class=\"hljs-comment\">/***************************************************/</span>\r\n<span class=\"hljs-comment\">/*   display error message                         */</span>\r\n<span class=\"hljs-comment\">/***************************************************/</span>\r\n<span class=\"hljs-comment\">/* x0 contains error code  x1 : message address */</span>\r\n<span class=\"hljs-symbol\">displayError:</span>\r\n    stp x2,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!            <span class=\"hljs-comment\">// save  registers</span>\r\n    <span class=\"hljs-keyword\">mov</span> x2,x0                      <span class=\"hljs-comment\">// save error code</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,x1\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n    <span class=\"hljs-keyword\">mov</span> x0,x2                      <span class=\"hljs-comment\">// error code</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrsZoneConv\r\n    <span class=\"hljs-keyword\">bl</span> conversion16                <span class=\"hljs-comment\">// conversion hexa</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x0,qAdrszMessErr           <span class=\"hljs-comment\">// display error message</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrsZoneConv\r\n    <span class=\"hljs-keyword\">bl</span> strInsertAtCharInc               <span class=\"hljs-comment\">// insert result at @ character</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,x0\r\n    <span class=\"hljs-keyword\">mov</span> x0,x2                      <span class=\"hljs-comment\">// error code</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrsZoneConv               <span class=\"hljs-comment\">// result address</span>\r\n    <span class=\"hljs-keyword\">bl</span> conversion10S                <span class=\"hljs-comment\">// conversion decimale</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,x3\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrsZoneConv\r\n    <span class=\"hljs-keyword\">bl</span> strInsertAtCharInc               <span class=\"hljs-comment\">// insert result at @ character</span>\r\n    <span class=\"hljs-keyword\">bl</span> affichageMess\r\n<span class=\"hljs-number\">100</span>:\r\n    ldp x2,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>],<span class=\"hljs-number\">16</span>              <span class=\"hljs-comment\">// restaur  2 registers</span>\r\n    ret                            <span class=\"hljs-comment\">// return to address lr x30</span>\r\n<span class=\"hljs-symbol\">qAdrszMessErr:</span>                 .quad szMessErr\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-comment\">/* init terminal state            */</span>\r\n<span class=\"hljs-comment\">/*********************************/</span>\r\n<span class=\"hljs-symbol\">initTerm:</span>\r\n    stp x1,<span class=\"hljs-built_in\">lr</span>,[<span class=\"hljs-built_in\">sp</span>,-<span class=\"hljs-number\">16</span>]!            <span class=\"hljs-comment\">// save  registers</span>\r\n    <span class=\"hljs-comment\">/* read terminal state */</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,STDIN                   <span class=\"hljs-comment\">// input console</span>\r\n    <span class=\"hljs-keyword\">mov</span> x1,TCGETS\r\n    <span class=\"hljs-keyword\">ldr</span> x2,qAdrstOldtio\r\n    <span class=\"hljs-keyword\">mov</span> x8,IOCTL                   <span class=\"hljs-comment\">// call system Linux</span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n    <span class=\"hljs-keyword\">cbnz</span> x0,<span class=\"hljs-number\">98</span>f                    <span class=\"hljs-comment\">// error ?</span>\r\n \r\n    <span class=\"hljs-keyword\">adr</span> x0,sighandler              <span class=\"hljs-comment\">// adresse routine traitement signal</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction         <span class=\"hljs-comment\">// adresse structure sigaction</span>\r\n    <span class=\"hljs-keyword\">str</span> x0,[x1,sa_handler]         <span class=\"hljs-comment\">// maj handler</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,SIGINT                  <span class=\"hljs-comment\">// signal type</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">mov</span> x3,<span class=\"hljs-number\">8</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,SIGACTION               <span class=\"hljs-comment\">// call system</span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n \r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// error ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">98</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x0,SIGQUIT\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// NULL</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,SIGACTION               <span class=\"hljs-comment\">// call system </span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// error ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">98</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x0,SIGTERM\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// NULL</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,SIGACTION               <span class=\"hljs-comment\">// appel systeme </span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">98</span>f\r\n    <span class=\"hljs-comment\">//</span>\r\n    <span class=\"hljs-keyword\">adr</span> x0,qAdrSIG_IGN             <span class=\"hljs-comment\">// address signal igonre function</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction1\r\n    <span class=\"hljs-keyword\">str</span> x0,[x1,sa_handler]\r\n    <span class=\"hljs-keyword\">mov</span> x0,SIGTTOU                 <span class=\"hljs-comment\">//invalidate other process signal</span>\r\n    <span class=\"hljs-keyword\">ldr</span> x1,qAdrstSigAction1\r\n    <span class=\"hljs-keyword\">mov</span> x2,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// NULL</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,SIGACTION               <span class=\"hljs-comment\">// call system </span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">98</span>f\r\n    <span class=\"hljs-comment\">//</span>\r\n    <span class=\"hljs-comment\">/* read terminal current state  */</span>\r\n    <span class=\"hljs-keyword\">mov</span> x0,STDIN\r\n    <span class=\"hljs-keyword\">mov</span> x1,TCGETS\r\n    <span class=\"hljs-keyword\">ldr</span> x2,qAdrstCurtio            <span class=\"hljs-comment\">// address current termio</span>\r\n    <span class=\"hljs-keyword\">mov</span> x8,IOCTL                   <span class=\"hljs-comment\">// call systeme </span>\r\n    <span class=\"hljs-keyword\">svc</span> <span class=\"hljs-number\">0</span> \r\n    <span class=\"hljs-keyword\">cmp</span> x0,<span class=\"hljs-number\">0</span>                       <span class=\"hljs-comment\">// error ?</span>\r\n    <span class=\"hljs-keyword\">bne</span> <span class=\"hljs-number\">98</span>f\r\n    <span class=\"hljs-keyword\">mov</span> x2,ICANON <span class=\"hljs-title\">| ECHO           // no key pressed echo on display\r\n    mvn x2,x2                      // and one key \r\n    ldr x1,qAdrstCurtio\r\n    ldr x3,[x1,#term_c_lflag]\r\n    and x3,x2,x2                   // add flags \r\n    str x3,[x1,#term_c_lflag]      // and store\r\n    mov x0,STDIN                   // maj terminal current state \r\n    mov x1,TCSETS\r\n    ldr x2,qAdrstCurtio\r\n    mov x8,IOCTL                   // call system\r\n    svc 0 \r\n    cbz x0,100f\r\n98:                                // error display\r\n    ldr x1,qAdrszMessErrInitTerm\r\n    bl   displayError\r\n    mov x0,-1\r\n100:\r\n    ldp x1,lr,[sp],16              // restaur  2 registers\r\n    ret                            // return to address lr x30\r\nqAdrstSigAction2:    .quad stSigAction2\r\nqAdrstSigAction3:    .quad stSigAction3\r\n/*********************************/\r\n/* init instance epool            */\r\n/*********************************/\r\ninitPoll:\r\n    stp x1,lr,[sp,-16]!            // save  registers\r\n    ldr x0,qAdrstevents\r\n    mov x1,STDIN                   // maj structure events\r\n    str x1,[x0,#poll_fd]           // maj FD\r\n    mov x1,POLLIN                  // action code\r\n    str x1,[x0,#poll_event]\r\n    mov x0,0\r\n    mov x8,CREATPOLL               // create epoll instance\r\n    svc 0\r\n    cmp x0,0                       // error ?\r\n    ble 98f\r\n    mov x10,x0                     // return FD epoll instance\r\n    mov x1,EPOLL_CTL_ADD\r\n    mov x2,STDIN                   // Fd to we want add\r\n    ldr x3,qAdrstevents            // structure events address\r\n    mov x8,CTLPOLL                 // call system control epoll\r\n    svc 0\r\n    cmp x0,0                       // error ?\r\n    blt 98f                       // no\r\n    mov x0,x10                     // return FD epoll instance\r\n    b 100f\r\n98:                                // error display\r\n    ldr x1,qAdrszMessErrInitPoll   // error message\r\n    bl   displayError\r\n    mov x0,-1\r\n100:\r\n    ldp x1,lr,[sp],16              // restaur  2 registers\r\n    ret                            // return to address lr x30\r\n/*********************************/\r\n/* wait key                      */\r\n/*********************************/\r\n/* x0 contains FD poll    */\r\nwaitKey:\r\n    stp x1,lr,[sp,-16]!            // save  registers\r\n    ldr x11,qAdrqTouche            // key address\r\n    str xzr,[x11]                  // raz key\r\n1:\r\n    ldr x1,qAdrqEnd                // if signal ctrl-c  -&gt; end\r\n    ldr x1,[x1]\r\n    cbnz x1,100f\r\n \r\n    ldr x1,qAdrstevents\r\n    mov x2,12                      // size events\r\n    mov x3,1                       // timeout = 1  TODO: ??\r\n    mov x4,0\r\n    mov x8,SYSPOLL                 // call system wait POLL\r\n    svc 0 \r\n    cmp x0,0                       // key pressed ?\r\n    bge 100f\r\n98:                                // error display\r\n    ldr x1,qAdrszMessErreurKey        // error message\r\n    bl   displayError\r\n    mov x0,-1\r\n100:\r\n    ldp x1,lr,[sp],16              // restaur  2 registers\r\n    ret                            // return to address lr x30\r\n/*********************************/\r\n/* read key                      */\r\n/*********************************/\r\n/* x0 returns key value */\r\nreadKey:\r\n    stp x1,lr,[sp,-16]!            // save  registers\r\n    mov x0,STDIN                   // File Descriptor\r\n    ldr x1,qAdrqTouche             // buffer address\r\n    mov x2,KEYSIZE                 // key size\r\n    mov x8,READ                    // read key\r\n    svc #0\r\n    cmp x0,0                       // error ?\r\n    ble 98f\r\n    ldr x2,qAdrqTouche             // key address\r\n    ldr x0,[x2]\r\n    b 100f\r\n98:                                // error display\r\n    ldr x1,qAdrszMessErreur        // error message\r\n    bl   displayError\r\n    mov x0,-1\r\n100:\r\n    ldp x1,lr,[sp],16              // restaur  2 registers\r\n    ret                            // return to address lr x30\r\n/*********************************/\r\n/* restaur terminal state        */\r\n/*********************************/\r\nrestauTerm:\r\n    stp x1,lr,[sp,-16]!            // save  registers\r\n    mov x0,STDIN                   // end then restaur begin state terminal\r\n    mov x1,TCSETS\r\n    ldr x2,qAdrstOldtio\r\n    mov x8,IOCTL                   // call system  \r\n    svc 0\r\n    cbz x0,100f\r\n    ldr x1,qAdrszMessErreur        // error message\r\n    bl   displayError\r\n100:\r\n    ldp x1,lr,[sp],16              // restaur  2 registers\r\n    ret                            // return to address lr x30\r\n/********************************************************/\r\n/*        File Include fonctions                        */\r\n/********************************************************/\r\n/* for this file see task include a file in language AArch64 assembly */\r\n.include &quot;../includeARM64.inc&quot;\r\n</span>"
    }
  },
  "contributors": [],
  "explanationUrl": {}
}