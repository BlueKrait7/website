{
  "slug": "bidirectional-a-star",
  "name": "Bidirectional a Star",
  "categories": [
    "graphs"
  ],
  "body": {},
  "implementations": {
    "python": {
      "dir": "graphs\\bidirectional_a_star.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/graphs\\bidirectional_a_star.py",
      "code": "<span class=\"hljs-string\">&quot;&quot;&quot;\r\nhttps://en.wikipedia.org/wiki/Bidirectional_search\r\n&quot;&quot;&quot;</span>\r\n<span class=\"hljs-keyword\">from</span> __future__ <span class=\"hljs-keyword\">import</span> annotations\r\n\r\n<span class=\"hljs-keyword\">import</span> time\r\n<span class=\"hljs-keyword\">from</span> math <span class=\"hljs-keyword\">import</span> sqrt\r\n\r\n<span class=\"hljs-comment\"># 1 for manhattan, 0 for euclidean</span>\r\nHEURISTIC = <span class=\"hljs-number\">0</span>\r\n\r\ngrid = [\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],  <span class=\"hljs-comment\"># 0 are free path whereas 1&#x27;s are obstacles</span>\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n    [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n    [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>],\r\n]\r\n\r\ndelta = [[-<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">0</span>, -<span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>]]  <span class=\"hljs-comment\"># up, left, down, right</span>\r\n\r\nTPosition = <span class=\"hljs-built_in\">tuple</span>[<span class=\"hljs-built_in\">int</span>, <span class=\"hljs-built_in\">int</span>]\r\n\r\n\r\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Node</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    &gt;&gt;&gt; k = Node(0, 0, 4, 3, 0, None)\r\n    &gt;&gt;&gt; k.calculate_heuristic()\r\n    5.0\r\n    &gt;&gt;&gt; n = Node(1, 4, 3, 4, 2, None)\r\n    &gt;&gt;&gt; n.calculate_heuristic()\r\n    2.0\r\n    &gt;&gt;&gt; l = [k, n]\r\n    &gt;&gt;&gt; n == l[0]\r\n    False\r\n    &gt;&gt;&gt; l.sort()\r\n    &gt;&gt;&gt; n == l[0]\r\n    True\r\n    &quot;&quot;&quot;</span>\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">\r\n        self,\r\n        pos_x: <span class=\"hljs-built_in\">int</span>,\r\n        pos_y: <span class=\"hljs-built_in\">int</span>,\r\n        goal_x: <span class=\"hljs-built_in\">int</span>,\r\n        goal_y: <span class=\"hljs-built_in\">int</span>,\r\n        g_cost: <span class=\"hljs-built_in\">int</span>,\r\n        parent: Node | <span class=\"hljs-literal\">None</span>,\r\n    </span>) -&gt; <span class=\"hljs-literal\">None</span>:\r\n        self.pos_x = pos_x\r\n        self.pos_y = pos_y\r\n        self.pos = (pos_y, pos_x)\r\n        self.goal_x = goal_x\r\n        self.goal_y = goal_y\r\n        self.g_cost = g_cost\r\n        self.parent = parent\r\n        self.h_cost = self.calculate_heuristic()\r\n        self.f_cost = self.g_cost + self.h_cost\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">calculate_heuristic</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">float</span>:\r\n        <span class=\"hljs-string\">&quot;&quot;&quot;\r\n        Heuristic for the A*\r\n        &quot;&quot;&quot;</span>\r\n        dy = self.pos_x - self.goal_x\r\n        dx = self.pos_y - self.goal_y\r\n        <span class=\"hljs-keyword\">if</span> HEURISTIC == <span class=\"hljs-number\">1</span>:\r\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">abs</span>(dx) + <span class=\"hljs-built_in\">abs</span>(dy)\r\n        <span class=\"hljs-keyword\">else</span>:\r\n            <span class=\"hljs-keyword\">return</span> sqrt(dy**<span class=\"hljs-number\">2</span> + dx**<span class=\"hljs-number\">2</span>)\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__lt__</span>(<span class=\"hljs-params\">self, other: Node</span>) -&gt; <span class=\"hljs-built_in\">bool</span>:\r\n        <span class=\"hljs-keyword\">return</span> self.f_cost &lt; other.f_cost\r\n\r\n\r\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AStar</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    &gt;&gt;&gt; astar = AStar((0, 0), (len(grid) - 1, len(grid[0]) - 1))\r\n    &gt;&gt;&gt; (astar.start.pos_y + delta[3][0], astar.start.pos_x + delta[3][1])\r\n    (0, 1)\r\n    &gt;&gt;&gt; [x.pos for x in astar.get_successors(astar.start)]\r\n    [(1, 0), (0, 1)]\r\n    &gt;&gt;&gt; (astar.start.pos_y + delta[2][0], astar.start.pos_x + delta[2][1])\r\n    (1, 0)\r\n    &gt;&gt;&gt; astar.retrace_path(astar.start)\r\n    [(0, 0)]\r\n    &gt;&gt;&gt; astar.search()  # doctest: +NORMALIZE_WHITESPACE\r\n    [(0, 0), (1, 0), (2, 0), (2, 1), (2, 2), (2, 3), (3, 3),\r\n     (4, 3), (4, 4), (5, 4), (5, 5), (6, 5), (6, 6)]\r\n    &quot;&quot;&quot;</span>\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, start: TPosition, goal: TPosition</span>):\r\n        self.start = Node(start[<span class=\"hljs-number\">1</span>], start[<span class=\"hljs-number\">0</span>], goal[<span class=\"hljs-number\">1</span>], goal[<span class=\"hljs-number\">0</span>], <span class=\"hljs-number\">0</span>, <span class=\"hljs-literal\">None</span>)\r\n        self.target = Node(goal[<span class=\"hljs-number\">1</span>], goal[<span class=\"hljs-number\">0</span>], goal[<span class=\"hljs-number\">1</span>], goal[<span class=\"hljs-number\">0</span>], <span class=\"hljs-number\">99999</span>, <span class=\"hljs-literal\">None</span>)\r\n\r\n        self.open_nodes = [self.start]\r\n        self.closed_nodes: <span class=\"hljs-built_in\">list</span>[Node] = []\r\n\r\n        self.reached = <span class=\"hljs-literal\">False</span>\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">search</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">list</span>[TPosition]:\r\n        <span class=\"hljs-keyword\">while</span> self.open_nodes:\r\n            <span class=\"hljs-comment\"># Open Nodes are sorted using __lt__</span>\r\n            self.open_nodes.sort()\r\n            current_node = self.open_nodes.pop(<span class=\"hljs-number\">0</span>)\r\n\r\n            <span class=\"hljs-keyword\">if</span> current_node.pos == self.target.pos:\r\n                <span class=\"hljs-keyword\">return</span> self.retrace_path(current_node)\r\n\r\n            self.closed_nodes.append(current_node)\r\n            successors = self.get_successors(current_node)\r\n\r\n            <span class=\"hljs-keyword\">for</span> child_node <span class=\"hljs-keyword\">in</span> successors:\r\n                <span class=\"hljs-keyword\">if</span> child_node <span class=\"hljs-keyword\">in</span> self.closed_nodes:\r\n                    <span class=\"hljs-keyword\">continue</span>\r\n\r\n                <span class=\"hljs-keyword\">if</span> child_node <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> self.open_nodes:\r\n                    self.open_nodes.append(child_node)\r\n                <span class=\"hljs-keyword\">else</span>:\r\n                    <span class=\"hljs-comment\"># retrieve the best current path</span>\r\n                    better_node = self.open_nodes.pop(self.open_nodes.index(child_node))\r\n\r\n                    <span class=\"hljs-keyword\">if</span> child_node.g_cost &lt; better_node.g_cost:\r\n                        self.open_nodes.append(child_node)\r\n                    <span class=\"hljs-keyword\">else</span>:\r\n                        self.open_nodes.append(better_node)\r\n\r\n        <span class=\"hljs-keyword\">return</span> [self.start.pos]\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_successors</span>(<span class=\"hljs-params\">self, parent: Node</span>) -&gt; <span class=\"hljs-built_in\">list</span>[Node]:\r\n        <span class=\"hljs-string\">&quot;&quot;&quot;\r\n        Returns a list of successors (both in the grid and free spaces)\r\n        &quot;&quot;&quot;</span>\r\n        successors = []\r\n        <span class=\"hljs-keyword\">for</span> action <span class=\"hljs-keyword\">in</span> delta:\r\n            pos_x = parent.pos_x + action[<span class=\"hljs-number\">1</span>]\r\n            pos_y = parent.pos_y + action[<span class=\"hljs-number\">0</span>]\r\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> (<span class=\"hljs-number\">0</span> &lt;= pos_x &lt;= <span class=\"hljs-built_in\">len</span>(grid[<span class=\"hljs-number\">0</span>]) - <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">0</span> &lt;= pos_y &lt;= <span class=\"hljs-built_in\">len</span>(grid) - <span class=\"hljs-number\">1</span>):\r\n                <span class=\"hljs-keyword\">continue</span>\r\n\r\n            <span class=\"hljs-keyword\">if</span> grid[pos_y][pos_x] != <span class=\"hljs-number\">0</span>:\r\n                <span class=\"hljs-keyword\">continue</span>\r\n\r\n            successors.append(\r\n                Node(\r\n                    pos_x,\r\n                    pos_y,\r\n                    self.target.pos_y,\r\n                    self.target.pos_x,\r\n                    parent.g_cost + <span class=\"hljs-number\">1</span>,\r\n                    parent,\r\n                )\r\n            )\r\n        <span class=\"hljs-keyword\">return</span> successors\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">retrace_path</span>(<span class=\"hljs-params\">self, node: Node | <span class=\"hljs-literal\">None</span></span>) -&gt; <span class=\"hljs-built_in\">list</span>[TPosition]:\r\n        <span class=\"hljs-string\">&quot;&quot;&quot;\r\n        Retrace the path from parents to parents until start node\r\n        &quot;&quot;&quot;</span>\r\n        current_node = node\r\n        path = []\r\n        <span class=\"hljs-keyword\">while</span> current_node <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:\r\n            path.append((current_node.pos_y, current_node.pos_x))\r\n            current_node = current_node.parent\r\n        path.reverse()\r\n        <span class=\"hljs-keyword\">return</span> path\r\n\r\n\r\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BidirectionalAStar</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    &gt;&gt;&gt; bd_astar = BidirectionalAStar((0, 0), (len(grid) - 1, len(grid[0]) - 1))\r\n    &gt;&gt;&gt; bd_astar.fwd_astar.start.pos == bd_astar.bwd_astar.target.pos\r\n    True\r\n    &gt;&gt;&gt; bd_astar.retrace_bidirectional_path(bd_astar.fwd_astar.start,\r\n    ...                                     bd_astar.bwd_astar.start)\r\n    [(0, 0)]\r\n    &gt;&gt;&gt; bd_astar.search()  # doctest: +NORMALIZE_WHITESPACE\r\n    [(0, 0), (0, 1), (0, 2), (1, 2), (1, 3), (2, 3), (2, 4),\r\n     (2, 5), (3, 5), (4, 5), (5, 5), (5, 6), (6, 6)]\r\n    &quot;&quot;&quot;</span>\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, start: TPosition, goal: TPosition</span>) -&gt; <span class=\"hljs-literal\">None</span>:\r\n        self.fwd_astar = AStar(start, goal)\r\n        self.bwd_astar = AStar(goal, start)\r\n        self.reached = <span class=\"hljs-literal\">False</span>\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">search</span>(<span class=\"hljs-params\">self</span>) -&gt; <span class=\"hljs-built_in\">list</span>[TPosition]:\r\n        <span class=\"hljs-keyword\">while</span> self.fwd_astar.open_nodes <span class=\"hljs-keyword\">or</span> self.bwd_astar.open_nodes:\r\n            self.fwd_astar.open_nodes.sort()\r\n            self.bwd_astar.open_nodes.sort()\r\n            current_fwd_node = self.fwd_astar.open_nodes.pop(<span class=\"hljs-number\">0</span>)\r\n            current_bwd_node = self.bwd_astar.open_nodes.pop(<span class=\"hljs-number\">0</span>)\r\n\r\n            <span class=\"hljs-keyword\">if</span> current_bwd_node.pos == current_fwd_node.pos:\r\n                <span class=\"hljs-keyword\">return</span> self.retrace_bidirectional_path(\r\n                    current_fwd_node, current_bwd_node\r\n                )\r\n\r\n            self.fwd_astar.closed_nodes.append(current_fwd_node)\r\n            self.bwd_astar.closed_nodes.append(current_bwd_node)\r\n\r\n            self.fwd_astar.target = current_bwd_node\r\n            self.bwd_astar.target = current_fwd_node\r\n\r\n            successors = {\r\n                self.fwd_astar: self.fwd_astar.get_successors(current_fwd_node),\r\n                self.bwd_astar: self.bwd_astar.get_successors(current_bwd_node),\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">for</span> astar <span class=\"hljs-keyword\">in</span> [self.fwd_astar, self.bwd_astar]:\r\n                <span class=\"hljs-keyword\">for</span> child_node <span class=\"hljs-keyword\">in</span> successors[astar]:\r\n                    <span class=\"hljs-keyword\">if</span> child_node <span class=\"hljs-keyword\">in</span> astar.closed_nodes:\r\n                        <span class=\"hljs-keyword\">continue</span>\r\n\r\n                    <span class=\"hljs-keyword\">if</span> child_node <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> astar.open_nodes:\r\n                        astar.open_nodes.append(child_node)\r\n                    <span class=\"hljs-keyword\">else</span>:\r\n                        <span class=\"hljs-comment\"># retrieve the best current path</span>\r\n                        better_node = astar.open_nodes.pop(\r\n                            astar.open_nodes.index(child_node)\r\n                        )\r\n\r\n                        <span class=\"hljs-keyword\">if</span> child_node.g_cost &lt; better_node.g_cost:\r\n                            astar.open_nodes.append(child_node)\r\n                        <span class=\"hljs-keyword\">else</span>:\r\n                            astar.open_nodes.append(better_node)\r\n\r\n        <span class=\"hljs-keyword\">return</span> [self.fwd_astar.start.pos]\r\n\r\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">retrace_bidirectional_path</span>(<span class=\"hljs-params\">\r\n        self, fwd_node: Node, bwd_node: Node\r\n    </span>) -&gt; <span class=\"hljs-built_in\">list</span>[TPosition]:\r\n        fwd_path = self.fwd_astar.retrace_path(fwd_node)\r\n        bwd_path = self.bwd_astar.retrace_path(bwd_node)\r\n        bwd_path.pop()\r\n        bwd_path.reverse()\r\n        path = fwd_path + bwd_path\r\n        <span class=\"hljs-keyword\">return</span> path\r\n\r\n\r\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\r\n    <span class=\"hljs-comment\"># all coordinates are given in format [y,x]</span>\r\n    init = (<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\r\n    goal = (<span class=\"hljs-built_in\">len</span>(grid) - <span class=\"hljs-number\">1</span>, <span class=\"hljs-built_in\">len</span>(grid[<span class=\"hljs-number\">0</span>]) - <span class=\"hljs-number\">1</span>)\r\n    <span class=\"hljs-keyword\">for</span> elem <span class=\"hljs-keyword\">in</span> grid:\r\n        <span class=\"hljs-built_in\">print</span>(elem)\r\n\r\n    start_time = time.time()\r\n    a_star = AStar(init, goal)\r\n    path = a_star.search()\r\n    end_time = time.time() - start_time\r\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;AStar execution time = <span class=\"hljs-subst\">{end_time:f}</span> seconds&quot;</span>)\r\n\r\n    bd_start_time = time.time()\r\n    bidir_astar = BidirectionalAStar(init, goal)\r\n    bd_end_time = time.time() - bd_start_time\r\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;BidirectionalAStar execution time = <span class=\"hljs-subst\">{bd_end_time:f}</span> seconds&quot;</span>)\r\n"
    }
  },
  "contributors": [
    {
      "name": "hasan",
      "email": "hasanuli10@gmail.com",
      "commits": 1
    },
    {
      "name": "Erwin Lejeune",
      "email": "erwin.lejeune15@gmail.com",
      "commits": 2
    },
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 3
    }
  ],
  "explanationUrl": {}
}