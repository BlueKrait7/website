{
  "slug": "pairing-heap",
  "name": "Pairing Heap",
  "categories": [
    "datastructures",
    "heap"
  ],
  "body": {},
  "implementations": {
    "c-sharp": {
      "dir": "./DataStructures/Heap/PairingHeap/PairingHeap.cs",
      "url": "https:\\github.com\\TheAlgorithms\\C-Sharp\\tree\\master\\DataStructures\\Heap\\PairingHeap\\PairingHeap.cs",
      "code": "ï»¿<span class=\"hljs-keyword\">using</span> System;\r\n<span class=\"hljs-keyword\">using</span> System.Collections;\r\n<span class=\"hljs-keyword\">using</span> System.Collections.Generic;\r\n<span class=\"hljs-keyword\">using</span> System.Linq;\r\n\r\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">DataStructures.Heap.PairingHeap</span>\r\n{\r\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\r\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> A pairing minMax heap implementation.</span>\r\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\r\n    <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;typeparam name=&quot;T&quot;&gt;</span>Base type.<span class=\"hljs-doctag\">&lt;/typeparam&gt;</span></span>\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PairingHeap</span>&lt;<span class=\"hljs-title\">T</span>&gt; : <span class=\"hljs-title\">IEnumerable</span>&lt;<span class=\"hljs-title\">T</span>&gt; <span class=\"hljs-keyword\">where</span> <span class=\"hljs-title\">T</span> : <span class=\"hljs-title\">IComparable</span>\r\n    {\r\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> Sorting sorting;\r\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> IComparer&lt;T&gt; comparer;\r\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> Dictionary&lt;T, List&lt;PairingHeapNode&lt;T&gt;&gt;&gt; mapping = <span class=\"hljs-keyword\">new</span>();\r\n\r\n        <span class=\"hljs-keyword\">private</span> PairingHeapNode&lt;T&gt; root = <span class=\"hljs-literal\">null</span>!;\r\n\r\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">int</span> Count { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">set</span>; }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">PairingHeap</span>(<span class=\"hljs-params\">Sorting sortDirection = Sorting.Ascending</span>)</span>\r\n        {\r\n            sorting = sortDirection;\r\n            comparer = <span class=\"hljs-keyword\">new</span> PairingNodeComparer&lt;T&gt;(sortDirection, Comparer&lt;T&gt;.Default);\r\n        }\r\n\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> Insert a new Node [O(1)].</span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Insert</span>(<span class=\"hljs-params\">T newItem</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">var</span> newNode = <span class=\"hljs-keyword\">new</span> PairingHeapNode&lt;T&gt;(newItem);\r\n\r\n            root = RebuildHeap(root, newNode);\r\n            Map(newItem, newNode);\r\n\r\n            Count++;\r\n        }\r\n\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> Get the element from heap [O(log(n))].</span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> T <span class=\"hljs-title\">Extract</span>()</span>\r\n        {\r\n            <span class=\"hljs-keyword\">var</span> minMax = root;\r\n\r\n            RemoveMapping(minMax.Value, minMax);\r\n            RebuildHeap(root.ChildrenHead);\r\n\r\n            Count--;\r\n            <span class=\"hljs-keyword\">return</span> minMax.Value;\r\n        }\r\n\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> Update heap key [O(log(n))].</span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">UpdateKey</span>(<span class=\"hljs-params\">T currentValue, T newValue</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span>(!mapping.ContainsKey(currentValue))\r\n            {\r\n                <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> ArgumentException(<span class=\"hljs-string\">&quot;Current value is not present in this heap.&quot;</span>);\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">var</span> node = mapping[currentValue]?.Where(x =&gt; x.Value.Equals(currentValue)).FirstOrDefault();\r\n\r\n            <span class=\"hljs-keyword\">if</span> (comparer.Compare(newValue, node!.Value) &gt; <span class=\"hljs-number\">0</span>)\r\n            {\r\n                <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> ArgumentException(<span class=\"hljs-string\">$&quot;New value is not <span class=\"hljs-subst\">{(sorting != Sorting.Descending ? <span class=\"hljs-string\">&quot;less&quot;</span> : <span class=\"hljs-string\">&quot;greater&quot;</span>)}</span> than old value.&quot;</span>);\r\n            }\r\n\r\n            UpdateNodeValue(currentValue, newValue, node);\r\n\r\n            <span class=\"hljs-keyword\">if</span> (node == root)\r\n            {\r\n                <span class=\"hljs-keyword\">return</span>;\r\n            }\r\n\r\n            DeleteChild(node);\r\n\r\n            root = RebuildHeap(root, node);\r\n        }\r\n\r\n        IEnumerator IEnumerable.GetEnumerator()\r\n        {\r\n            <span class=\"hljs-keyword\">return</span> GetEnumerator();\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> IEnumerator&lt;T&gt; <span class=\"hljs-title\">GetEnumerator</span>()</span>\r\n        {\r\n            <span class=\"hljs-keyword\">return</span> mapping.SelectMany(x =&gt; x.Value).Select(x =&gt; x.Value).GetEnumerator();\r\n        }\r\n\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;summary&gt;</span></span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> Rebuild heap on action [O(log(n))].</span>\r\n        <span class=\"hljs-comment\"><span class=\"hljs-doctag\">///</span> <span class=\"hljs-doctag\">&lt;/summary&gt;</span></span>\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">RebuildHeap</span>(<span class=\"hljs-params\">PairingHeapNode&lt;T&gt; headNode</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span> (headNode == <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                <span class=\"hljs-keyword\">return</span>;\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">var</span> passOneResult = <span class=\"hljs-keyword\">new</span> List&lt;PairingHeapNode&lt;T&gt;&gt;();\r\n            <span class=\"hljs-keyword\">var</span> current = headNode;\r\n\r\n            <span class=\"hljs-keyword\">if</span> (current.Next == <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                headNode.Next = <span class=\"hljs-literal\">null</span>!;\r\n                headNode.Previous = <span class=\"hljs-literal\">null</span>!;\r\n                passOneResult.Add(headNode);\r\n            }\r\n            <span class=\"hljs-keyword\">else</span>\r\n            {\r\n                <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>)\r\n                {\r\n                    <span class=\"hljs-keyword\">if</span> (current == <span class=\"hljs-literal\">null</span>)\r\n                    {\r\n                        <span class=\"hljs-keyword\">break</span>;\r\n                    }\r\n\r\n                    <span class=\"hljs-keyword\">if</span> (current.Next != <span class=\"hljs-literal\">null</span>)\r\n                    {\r\n                        <span class=\"hljs-keyword\">var</span> next = current.Next;\r\n                        <span class=\"hljs-keyword\">var</span> nextNext = next.Next;\r\n                        passOneResult.Add(RebuildHeap(current, next));\r\n                        current = nextNext;\r\n                    }\r\n                    <span class=\"hljs-keyword\">else</span>\r\n                    {\r\n                        <span class=\"hljs-keyword\">var</span> lastInserted = passOneResult[^<span class=\"hljs-number\">1</span>];\r\n                        passOneResult[^<span class=\"hljs-number\">1</span>] = RebuildHeap(lastInserted, current);\r\n                        <span class=\"hljs-keyword\">break</span>;\r\n                    }\r\n                }\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">var</span> passTwoResult = passOneResult[^<span class=\"hljs-number\">1</span>];\r\n\r\n            <span class=\"hljs-keyword\">if</span> (passOneResult.Count == <span class=\"hljs-number\">1</span>)\r\n            {\r\n                root = passTwoResult;\r\n                <span class=\"hljs-keyword\">return</span>;\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = passOneResult.Count - <span class=\"hljs-number\">2</span>; i &gt;= <span class=\"hljs-number\">0</span>; i--)\r\n            {\r\n                current = passOneResult[i];\r\n                passTwoResult = RebuildHeap(passTwoResult, current);\r\n            }\r\n\r\n            root = passTwoResult;\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> PairingHeapNode&lt;T&gt; <span class=\"hljs-title\">RebuildHeap</span>(<span class=\"hljs-params\">PairingHeapNode&lt;T&gt; node1, PairingHeapNode&lt;T&gt; node2</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span> (node2 != <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                node2.Previous = <span class=\"hljs-literal\">null</span>!;\r\n                node2.Next = <span class=\"hljs-literal\">null</span>!;\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">if</span> (node1 == <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                <span class=\"hljs-keyword\">return</span> node2!;\r\n            }\r\n\r\n            node1.Previous = <span class=\"hljs-literal\">null</span>!;\r\n            node1.Next = <span class=\"hljs-literal\">null</span>!;\r\n\r\n            <span class=\"hljs-keyword\">if</span> (node2 != <span class=\"hljs-literal\">null</span> &amp;&amp; comparer.Compare(node1.Value, node2.Value) &lt;= <span class=\"hljs-number\">0</span>)\r\n            {\r\n                AddChild(<span class=\"hljs-keyword\">ref</span> node1, node2);\r\n                <span class=\"hljs-keyword\">return</span> node1;\r\n            }\r\n\r\n            AddChild(<span class=\"hljs-keyword\">ref</span> node2!, node1);\r\n            <span class=\"hljs-keyword\">return</span> node2;\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">AddChild</span>(<span class=\"hljs-params\"><span class=\"hljs-keyword\">ref</span> PairingHeapNode&lt;T&gt; parent, PairingHeapNode&lt;T&gt; child</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span> (parent.ChildrenHead == <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                parent.ChildrenHead = child;\r\n                child.Previous = parent;\r\n                <span class=\"hljs-keyword\">return</span>;\r\n            }\r\n\r\n            <span class=\"hljs-keyword\">var</span> head = parent.ChildrenHead;\r\n\r\n            child.Previous = head;\r\n            child.Next = head.Next;\r\n\r\n            <span class=\"hljs-keyword\">if</span> (head.Next != <span class=\"hljs-literal\">null</span>)\r\n            {\r\n                head.Next.Previous = child;\r\n            }\r\n\r\n            head.Next = child;\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">DeleteChild</span>(<span class=\"hljs-params\">PairingHeapNode&lt;T&gt; node</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span> (node.IsHeadChild)\r\n            {\r\n                <span class=\"hljs-keyword\">var</span> parent = node.Previous;\r\n\r\n                <span class=\"hljs-keyword\">if</span> (node.Next != <span class=\"hljs-literal\">null</span>)\r\n                {\r\n                    node.Next.Previous = parent;\r\n                }\r\n\r\n                parent.ChildrenHead = node.Next!;\r\n            }\r\n            <span class=\"hljs-keyword\">else</span>\r\n            {\r\n                node.Previous.Next = node.Next;\r\n\r\n                <span class=\"hljs-keyword\">if</span> (node.Next != <span class=\"hljs-literal\">null</span>)\r\n                {\r\n                    node.Next.Previous = node.Previous;\r\n                }\r\n            }\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">Map</span>(<span class=\"hljs-params\">T newItem, PairingHeapNode&lt;T&gt; newNode</span>)</span>\r\n        {\r\n            <span class=\"hljs-keyword\">if</span> (mapping.ContainsKey(newItem))\r\n            {\r\n                mapping[newItem].Add(newNode);\r\n            }\r\n            <span class=\"hljs-keyword\">else</span>\r\n            {\r\n                mapping[newItem] = <span class=\"hljs-keyword\">new</span> List&lt;PairingHeapNode&lt;T&gt;&gt;(<span class=\"hljs-keyword\">new</span>[] { newNode });\r\n            }\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">UpdateNodeValue</span>(<span class=\"hljs-params\">T currentValue, T newValue, PairingHeapNode&lt;T&gt; node</span>)</span>\r\n        {\r\n            RemoveMapping(currentValue, node);\r\n            node.Value = newValue;\r\n            Map(newValue, node);\r\n        }\r\n\r\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">RemoveMapping</span>(<span class=\"hljs-params\">T currentValue, PairingHeapNode&lt;T&gt; node</span>)</span>\r\n        {\r\n            mapping[currentValue].Remove(node);\r\n            <span class=\"hljs-keyword\">if</span> (mapping[currentValue].Count == <span class=\"hljs-number\">0</span>)\r\n            {\r\n                mapping.Remove(currentValue);\r\n            }\r\n        }\r\n    }\r\n}\r\n"
    }
  },
  "contributors": [
    {
      "name": "Sergii Lischuk",
      "email": "evertodante@gmail.com",
      "commits": 1
    }
  ],
  "explanationUrl": {}
}