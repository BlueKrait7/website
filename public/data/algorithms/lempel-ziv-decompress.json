{
  "slug": "lempel-ziv-decompress",
  "name": "Lempel Ziv Decompress",
  "categories": [
    "compression"
  ],
  "body": {},
  "implementations": {
    "python": {
      "dir": "compression\\lempel_ziv_decompress.py",
      "url": "https://github.com/TheAlgorithms/python/tree/master/compression\\lempel_ziv_decompress.py",
      "code": "<span class=\"hljs-string\">&quot;&quot;&quot;\r\n    One of the several implementations of Lempel–Ziv–Welch decompression algorithm\r\n    https://en.wikipedia.org/wiki/Lempel%E2%80%93Ziv%E2%80%93Welch\r\n&quot;&quot;&quot;</span>\r\n\r\n<span class=\"hljs-keyword\">import</span> math\r\n<span class=\"hljs-keyword\">import</span> sys\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">read_file_binary</span>(<span class=\"hljs-params\">file_path: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Reads given file as bytes and returns them as a long string\r\n    &quot;&quot;&quot;</span>\r\n    result = <span class=\"hljs-string\">&quot;&quot;</span>\r\n    <span class=\"hljs-keyword\">try</span>:\r\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(file_path, <span class=\"hljs-string\">&quot;rb&quot;</span>) <span class=\"hljs-keyword\">as</span> binary_file:\r\n            data = binary_file.read()\r\n        <span class=\"hljs-keyword\">for</span> dat <span class=\"hljs-keyword\">in</span> data:\r\n            curr_byte = <span class=\"hljs-string\">f&quot;<span class=\"hljs-subst\">{dat:08b}</span>&quot;</span>\r\n            result += curr_byte\r\n        <span class=\"hljs-keyword\">return</span> result\r\n    <span class=\"hljs-keyword\">except</span> OSError:\r\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;File not accessible&quot;</span>)\r\n        sys.exit()\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">decompress_data</span>(<span class=\"hljs-params\">data_bits: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Decompresses given data_bits using Lempel–Ziv–Welch compression algorithm\r\n    and returns the result as a string\r\n    &quot;&quot;&quot;</span>\r\n    lexicon = {<span class=\"hljs-string\">&quot;0&quot;</span>: <span class=\"hljs-string\">&quot;0&quot;</span>, <span class=\"hljs-string\">&quot;1&quot;</span>: <span class=\"hljs-string\">&quot;1&quot;</span>}\r\n    result, curr_string = <span class=\"hljs-string\">&quot;&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>\r\n    index = <span class=\"hljs-built_in\">len</span>(lexicon)\r\n\r\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(data_bits)):\r\n        curr_string += data_bits[i]\r\n        <span class=\"hljs-keyword\">if</span> curr_string <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> lexicon:\r\n            <span class=\"hljs-keyword\">continue</span>\r\n\r\n        last_match_id = lexicon[curr_string]\r\n        result += last_match_id\r\n        lexicon[curr_string] = last_match_id + <span class=\"hljs-string\">&quot;0&quot;</span>\r\n\r\n        <span class=\"hljs-keyword\">if</span> math.log2(index).is_integer():\r\n            newLex = {}\r\n            <span class=\"hljs-keyword\">for</span> curr_key <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">list</span>(lexicon):\r\n                newLex[<span class=\"hljs-string\">&quot;0&quot;</span> + curr_key] = lexicon.pop(curr_key)\r\n            lexicon = newLex\r\n\r\n        lexicon[<span class=\"hljs-built_in\">bin</span>(index)[<span class=\"hljs-number\">2</span>:]] = last_match_id + <span class=\"hljs-string\">&quot;1&quot;</span>\r\n        index += <span class=\"hljs-number\">1</span>\r\n        curr_string = <span class=\"hljs-string\">&quot;&quot;</span>\r\n    <span class=\"hljs-keyword\">return</span> result\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">write_file_binary</span>(<span class=\"hljs-params\">file_path: <span class=\"hljs-built_in\">str</span>, to_write: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Writes given to_write string (should only consist of 0&#x27;s and 1&#x27;s) as bytes in the\r\n    file\r\n    &quot;&quot;&quot;</span>\r\n    byte_length = <span class=\"hljs-number\">8</span>\r\n    <span class=\"hljs-keyword\">try</span>:\r\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(file_path, <span class=\"hljs-string\">&quot;wb&quot;</span>) <span class=\"hljs-keyword\">as</span> opened_file:\r\n            result_byte_array = [\r\n                to_write[i : i + byte_length]\r\n                <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(to_write), byte_length)\r\n            ]\r\n\r\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(result_byte_array[-<span class=\"hljs-number\">1</span>]) % byte_length == <span class=\"hljs-number\">0</span>:\r\n                result_byte_array.append(<span class=\"hljs-string\">&quot;10000000&quot;</span>)\r\n            <span class=\"hljs-keyword\">else</span>:\r\n                result_byte_array[-<span class=\"hljs-number\">1</span>] += <span class=\"hljs-string\">&quot;1&quot;</span> + <span class=\"hljs-string\">&quot;0&quot;</span> * (\r\n                    byte_length - <span class=\"hljs-built_in\">len</span>(result_byte_array[-<span class=\"hljs-number\">1</span>]) - <span class=\"hljs-number\">1</span>\r\n                )\r\n\r\n            <span class=\"hljs-keyword\">for</span> elem <span class=\"hljs-keyword\">in</span> result_byte_array[:-<span class=\"hljs-number\">1</span>]:\r\n                opened_file.write(<span class=\"hljs-built_in\">int</span>(elem, <span class=\"hljs-number\">2</span>).to_bytes(<span class=\"hljs-number\">1</span>, byteorder=<span class=\"hljs-string\">&quot;big&quot;</span>))\r\n    <span class=\"hljs-keyword\">except</span> OSError:\r\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;File not accessible&quot;</span>)\r\n        sys.exit()\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">remove_prefix</span>(<span class=\"hljs-params\">data_bits: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">str</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Removes size prefix, that compressed file should have\r\n    Returns the result\r\n    &quot;&quot;&quot;</span>\r\n    counter = <span class=\"hljs-number\">0</span>\r\n    <span class=\"hljs-keyword\">for</span> letter <span class=\"hljs-keyword\">in</span> data_bits:\r\n        <span class=\"hljs-keyword\">if</span> letter == <span class=\"hljs-string\">&quot;1&quot;</span>:\r\n            <span class=\"hljs-keyword\">break</span>\r\n        counter += <span class=\"hljs-number\">1</span>\r\n\r\n    data_bits = data_bits[counter:]\r\n    data_bits = data_bits[counter + <span class=\"hljs-number\">1</span> :]\r\n    <span class=\"hljs-keyword\">return</span> data_bits\r\n\r\n\r\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">compress</span>(<span class=\"hljs-params\">source_path: <span class=\"hljs-built_in\">str</span>, destination_path: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:\r\n    <span class=\"hljs-string\">&quot;&quot;&quot;\r\n    Reads source file, decompresses it and writes the result in destination file\r\n    &quot;&quot;&quot;</span>\r\n    data_bits = read_file_binary(source_path)\r\n    data_bits = remove_prefix(data_bits)\r\n    decompressed = decompress_data(data_bits)\r\n    write_file_binary(destination_path, decompressed)\r\n\r\n\r\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\r\n    compress(sys.argv[<span class=\"hljs-number\">1</span>], sys.argv[<span class=\"hljs-number\">2</span>])\r\n"
    }
  },
  "contributors": [
    {
      "name": "Christian Clauss",
      "email": "cclauss@me.com",
      "commits": 1
    },
    {
      "name": "Ioane Margiani",
      "email": "margianiioane@gmail.com",
      "commits": 1
    }
  ],
  "explanationUrl": {}
}